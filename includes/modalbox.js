if(!window.Modalbox){var Modalbox=new Object()}Modalbox.Methods={overrideAlert:false,focusableElements:new Array,options:{title:"ModalBox Window",overlayClose:true,width:500,height:90,overlayOpacity:0.75,overlayDuration:0.25,slideDownDuration:0.5,slideUpDuration:0.15,resizeDuration:0.2,inactiveFade:true,transitions:true,loadingString:"Please wait. Loading...",closeString:"Close window",params:{},method:"get"},_options:new Object,setOptions:function(a){Object.extend(this.options,a||{})},_init:function(a){Object.extend(this._options,this.options);this.setOptions(a);this.MBoverlay=Builder.node("div",{id:"MB_overlay",opacity:"0"});this.MBwindow=Builder.node("div",{id:"MB_window",style:"display: none"},[this.MBframe=Builder.node("div",{id:"MB_frame"},[this.MBheader=Builder.node("div",{id:"MB_header"},[this.MBcaption=Builder.node("div",{id:"MB_caption"}),this.MBclose=Builder.node("a",{id:"MB_close",title:this.options.closeString,href:"#"},[Builder.build("<span>&times;</span>"),]),]),this.MBcontent=Builder.node("div",{id:"MB_content"},[this.MBloading=Builder.node("div",{id:"MB_loading"},this.options.loadingString),]),]),]);document.body.insertBefore(this.MBwindow,document.body.childNodes[0]);document.body.insertBefore(this.MBoverlay,document.body.childNodes[0]);this.initScrollX=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;this.initScrollY=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;this.hide=this.hide.bindAsEventListener(this);this.close=this._hide.bindAsEventListener(this);this.kbdHandler=this.kbdHandler.bindAsEventListener(this);this._initObservers();this.initialized=true;this.active=true;this.currFocused=0},show:function(b,a){if(!this.initialized){this._init(a)}this.content=b;this.setOptions(a);Element.update(this.MBcaption,this.options.title);if(this.MBwindow.style.display=="none"){this._appear();this.event("onShow")}else{this._update();this.event("onUpdate")}},hide:function(a){if(this.initialized){if(a){Object.extend(this.options,a)}if(this.options.transitions){Effect.SlideUp(this.MBwindow,{duration:this.options.slideUpDuration,afterFinish:this._deinit.bind(this)})}else{Element.hide(this.MBwindow);this._deinit()}}else{throw ("Modalbox isn't initialized")}},alert:function(b){var a='<div class="MB_alert"><p>'+b+'</p><input type="button" onclick="Modalbox.hide()" value="OK" /></div>';Modalbox.show(a,{title:"Alert: "+document.title,width:300})},_hide:function(a){if(a){Event.stop(a)}this.hide()},_appear:function(){if(navigator.appVersion.match(/\bMSIE\b/)){this._toggleSelects()}this._setOverlay();this._setWidth();this._setPosition();if(this.options.transitions){Element.setStyle(this.MBoverlay,{opacity:0});new Effect.Fade(this.MBoverlay,{from:0,to:this.options.overlayOpacity,duration:this.options.overlayDuration,afterFinish:function(){new Effect.SlideDown(this.MBwindow,{duration:this.options.slideDownDuration,afterFinish:function(){this._setPosition();this.loadContent()}.bind(this)})}.bind(this)})}else{Element.setStyle(this.MBoverlay,{opacity:this.options.overlayOpacity});Element.show(this.MBwindow);this._setPosition();this.loadContent()}this._setWidthAndPosition=this._setWidthAndPosition.bindAsEventListener(this);Event.observe(window,"resize",this._setWidthAndPosition)},resize:function(g,h,c){var f=Element.getHeight(this.MBwindow);var d=Element.getWidth(this.MBwindow);var e=Element.getHeight(this.MBheader);var b=Element.getHeight(this.MBcontent);var a=((f-e+h)<b)?(b+e-f):h;this.setOptions(c);if(this.options.transitions){new Effect.ScaleBy(this.MBwindow,g,a,{duration:this.options.resizeDuration,afterFinish:function(){this.event("_afterResize");this.event("afterResize")}.bind(this)})}else{this.MBwindow.setStyle({width:d+g+"px",height:f+a+"px"});setTimeout(function(){this.event("_afterResize");this.event("afterResize")}.bind(this),1)}},_update:function(){Element.update(this.MBcontent,"");this.MBcontent.appendChild(this.MBloading);Element.update(this.MBloading,this.options.loadingString);this.currentDims=[this.MBwindow.offsetWidth,this.MBwindow.offsetHeight];Modalbox.resize((this.options.width-this.currentDims[0]),(this.options.height-this.currentDims[1]),{_afterResize:this._loadAfterResize.bind(this)})},loadContent:function(){if(this.event("beforeLoad")!=false){if(typeof this.content=="string"){var htmlRegExp=new RegExp(/<\/?[^>]+>/gi);if(htmlRegExp.test(this.content)){this._insertContent(this.content);this._putContent()}else{new Ajax.Request(this.content,{method:this.options.method.toLowerCase(),parameters:this.options.params,onComplete:function(transport){var response=new String(transport.responseText);this._insertContent(transport.responseText.stripScripts());response.extractScripts().map(function(script){return eval(script.replace("<!--","").replace("// -->",""))}.bind(window));this._putContent()}.bind(this)})}}else{if(typeof this.content=="object"){this._insertContent(this.content);this._putContent()}else{Modalbox.hide();throw ("Please specify correct URL or HTML element (plain HTML or object)")}}}},_insertContent:function(b){Element.extend(this.MBcontent);this.MBcontent.update("");if(typeof b=="string"){this.MBcontent.hide().update(b)}else{if(typeof this.content=="object"){var a=b.cloneNode(true);if(this.content.id){this.content.id="MB_"+this.content.id}this.content.getElementsBySelector("*[id]").each(function(c){c.id="MB_"+c.id});this.MBcontent.hide().appendChild(a);this.MBcontent.down().show()}}},_putContent:function(){if(this.options.height==this._options.height){Modalbox.resize(0,this.MBcontent.getHeight()-Element.getHeight(this.MBwindow)+Element.getHeight(this.MBheader),{afterResize:function(){this.MBcontent.show();this.focusableElements=this._findFocusableElements();this._setFocus();this.event("afterLoad")}.bind(this)})}else{this._setWidth();this.MBcontent.setStyle({overflow:"auto",height:Element.getHeight(this.MBwindow)-Element.getHeight(this.MBheader)-13+"px"});this.MBcontent.show();this.focusableElements=this._findFocusableElements();this._setFocus();this.event("afterLoad")}},activate:function(a){this.setOptions(a);this.active=true;Event.observe(this.MBclose,"click",this.close);if(this.options.overlayClose){Event.observe(this.MBoverlay,"click",this.hide)}Element.show(this.MBclose);if(this.options.transitions&&this.options.inactiveFade){new Effect.Appear(this.MBwindow,{duration:this.options.slideUpDuration})}},deactivate:function(a){this.setOptions(a);this.active=false;Event.stopObserving(this.MBclose,"click",this.close);if(this.options.overlayClose){Event.stopObserving(this.MBoverlay,"click",this.hide)}Element.hide(this.MBclose);if(this.options.transitions&&this.options.inactiveFade){new Effect.Fade(this.MBwindow,{duration:this.options.slideUpDuration,to:0.75})}},_initObservers:function(){Event.observe(this.MBclose,"click",this.close);if(this.options.overlayClose){Event.observe(this.MBoverlay,"click",this.hide)}Event.observe(document,"keypress",Modalbox.kbdHandler)},_removeObservers:function(){Event.stopObserving(this.MBclose,"click",this.close);if(this.options.overlayClose){Event.stopObserving(this.MBoverlay,"click",this.hide)}Event.stopObserving(document,"keypress",Modalbox.kbdHandler)},_loadAfterResize:function(){this._setWidth();this._setPosition();this.loadContent()},_setFocus:function(){if(this.focusableElements.length>0){var b=0;var a=this.focusableElements.find(function c(d){b++;return d.tabIndex==1})||this.focusableElements.first();this.currFocused=(b==this.focusableElements.length-1)?(b-1):0;a.focus()}else{$("MB_close").focus()}},_findFocusableElements:function(){var a=this.MBcontent.getElementsBySelector("input:not([type~=hidden]), select, textarea, button, a[href]");a.invoke("addClassName","MB_focusable");return this.MBcontent.getElementsByClassName("MB_focusable")},kbdHandler:function(b){var a=Event.element(b);switch(b.keyCode){case Event.KEY_TAB:Event.stop(b);if(!b.shiftKey){if(this.currFocused==this.focusableElements.length-1){this.focusableElements.first().focus();this.currFocused=0}else{this.currFocused++;this.focusableElements[this.currFocused].focus()}}else{if(this.currFocused==0){this.focusableElements.last().focus();this.currFocused=this.focusableElements.length-1}else{this.currFocused--;this.focusableElements[this.currFocused].focus()}}break;case Event.KEY_ESC:if(this.active){this._hide(b)}break;case 32:this._preventScroll(b);break;case 0:if(b.which==32){this._preventScroll(b)}break;case Event.KEY_UP:case Event.KEY_DOWN:case Event.KEY_PAGEDOWN:case Event.KEY_PAGEUP:case Event.KEY_HOME:case Event.KEY_END:if(/Safari|KHTML/.test(navigator.userAgent)&&!["textarea","select"].include(a.tagName.toLowerCase())){Event.stop(b)}else{if((a.tagName.toLowerCase()=="input"&&["submit","button"].include(a.type))||(a.tagName.toLowerCase()=="a")){Event.stop(b)}}break}},_preventScroll:function(a){if(!["input","textarea","select","button"].include(Event.element(a).tagName.toLowerCase())){Event.stop(a)}},_deinit:function(){this._removeObservers();Event.stopObserving(window,"resize",this._setWidthAndPosition);if(this.options.transitions){Effect.toggle(this.MBoverlay,"appear",{duration:this.options.overlayDuration,afterFinish:this._removeElements.bind(this)})}else{this.MBoverlay.hide();this._removeElements()}Element.setStyle(this.MBcontent,{overflow:"",height:""})},_removeElements:function(){if(navigator.appVersion.match(/\bMSIE\b/)){this._prepareIE("","");window.scrollTo(this.initScrollX,this.initScrollY)}Element.remove(this.MBoverlay);Element.remove(this.MBwindow);if(typeof this.content=="object"&&this.content.id&&this.content.id.match(/MB_/)){this.content.getElementsBySelector("*[id]").each(function(a){a.id=a.id.replace(/MB_/,"")});this.content.id=this.content.id.replace(/MB_/,"")}this.initialized=false;if(navigator.appVersion.match(/\bMSIE\b/)){this._toggleSelects()}this.event("afterHide");this.setOptions(this._options)},_setOverlay:function(){if(navigator.appVersion.match(/\bMSIE\b/)){this._prepareIE("100%","hidden");if(!navigator.appVersion.match(/\b7.0\b/)){window.scrollTo(0,0)}}},_setWidth:function(){Element.setStyle(this.MBwindow,{width:this.options.width+"px",height:this.options.height+"px"})},_setPosition:function(){Element.setStyle(this.MBwindow,{left:Math.round((Element.getWidth(document.body)-Element.getWidth(this.MBwindow))/2)+"px"})},_setWidthAndPosition:function(){Element.setStyle(this.MBwindow,{width:this.options.width+"px"});this._setPosition()},_getScrollTop:function(){var a;if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body){a=document.body.scrollTop}}return a},_prepareIE:function(b,d){var a=document.getElementsByTagName("body")[0];a.style.height=b;a.style.overflow=d;var c=document.getElementsByTagName("html")[0];c.style.height=b;c.style.overflow=d},_toggleSelects:function(){var a=$$("select");if(this.initialized){a.invoke("setStyle",{visibility:"hidden"})}else{a.invoke("setStyle",{visibility:""})}},event:function(a){if(this.options[a]){var b=this.options[a]();this.options[a]=null;if(b!=undefined){return b}else{return true}}return true}};Object.extend(Modalbox,Modalbox.Methods);if(Modalbox.overrideAlert){window.alert=Modalbox.alert}Effect.ScaleBy=Class.create();Object.extend(Object.extend(Effect.ScaleBy.prototype,Effect.Base.prototype),{initialize:function(b,c,d,a){this.element=$(b);var a=Object.extend({scaleFromTop:true,scaleMode:"box",scaleByWidth:c,scaleByHeight:d},arguments[3]||{});this.start(a)},setup:function(){this.elementPositioning=this.element.getStyle("position");this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}this.deltaY=this.options.scaleByHeight;this.deltaX=this.options.scaleByWidth},update:function(a){var c=this.dims[0]+(this.deltaY*a);var b=this.dims[1]+(this.deltaX*a);c=(c>0)?c:0;b=(b>0)?b:0;this.setDimensions(c,b)},setDimensions:function(a,e){var f={};f.width=e+"px";f.height=a+"px";var c=Math.round((a-this.dims[0])/2);var b=Math.round((e-this.dims[1])/2);if(this.elementPositioning=="absolute"||this.elementPositioning=="fixed"){if(!this.options.scaleFromTop){f.top=this.originalTop-c+"px"}f.left=this.originalLeft-b+"px"}else{if(!this.options.scaleFromTop){f.top=-c+"px"}f.left=-b+"px"}this.element.setStyle(f)}});