<!DOCTYPE html>
<html class="limited-width larger-font" prefix="
og: http://ogp.me/ns#
" lang="pl">
<head>
<meta charset="utf-8">
<meta name="description" content="A collection of tricks to convince macOS installers to work.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reinstalling macOS: What To Try When All Else Fails | Chris Warrick</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css" integrity="sha256-FqCzNnnyXl5HxHMdb+RQ/RV/X7fqfPcQYy+G2gFL3Xk=" crossorigin="anonymous">
<!--#if expr="$HTTP_COOKIE=/colorScheme\=light/" --><link href="/assets/css/all.css?v=20230115" rel="stylesheet" type="text/css" id="kw-all-css">
<script type="text/javascript">var colorScheme='light';var colorSchemesEnabled=true;</script><!--#else--><link href="/assets/css/all-dark.css?v=20230115" rel="stylesheet" type="text/css" id="kw-all-css">
<script type="text/javascript">var colorScheme='dark';var colorSchemesEnabled=true;</script><!--#endif--><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i%7CSource+Serif+Pro:600&amp;display=swap&amp;subset=latin-ext" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<meta name="theme-color" content="#00aadd">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="/rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="/pl/rss.xml">
<link rel="canonical" href="https://chriswarrick.com/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/">
<link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="16x16 32x32 48x48 64x64 128x128 256x256">
<link rel="icon" type="image/png" href="/assets/img/logo512.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="description" itemprop="description" content="A collection of tricks to convince macOS installers to work.">
<meta name="author" content="Chris Warrick">
<link rel="prev" href="/pl/blog/2020/02/09/when-html-is-not-enough-a-tale-of-the-datalist-element/" title="When HTML is not enough: a tale of the &lt;datalist&gt; element" type="text/html">
<link rel="next" href="/pl/blog/2020/06/22/what-an-arm-mac-means-for-developers-and-windows-users/" title="What an ARM Mac means for developers and Windows users" type="text/html">
<meta property="og:site_name" content="Chris Warrick">
<meta property="og:title" content="Reinstalling macOS: What To Try When All Else Fails">
<meta property="og:url" content="https://chriswarrick.com/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/">
<meta property="og:description" content="A collection of tricks to convince macOS installers to work.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-06-03T23:00:00+02:00">
<meta property="article:tag" content="Apple">
<meta property="article:tag" content="install">
<meta property="article:tag" content="Mac">
<meta property="article:tag" content="macOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@Kwpolska">
<link rel="alternate" hreflang="en" href="/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Przejdź do treści</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md navbar-kw bg-dark static-top mb-4"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="/pl/">
            <img src="/assets/img/logo.png" srcset="/assets/img/logo2x.png 2x" alt="Chris Warrick" id="logo"><span id="blog-title">Chris Warrick</span>
        </a>
        <div>
        <button class="navbar-toggler mr-2" id="color-changer-mobile" type="button" aria-label="Change color scheme">
            <span class="color-changer"></span>
        </button>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        </div>
        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="/pl/contact/" class="nav-link">Kontakt</a>
                </li>
<li class="nav-item">
<a href="/projects/" class="nav-link">Projekty</a>
                </li>
<li class="nav-item">
<a href="/guides/" class="nav-link">Przewodniki</a>
                </li>
<li class="nav-item">
<a href="/pl/blog/" class="nav-link">Archiwum</a>
                </li>
<li class="nav-item">
<a href="/pl/search/" class="nav-link">Szukaj</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li>            </li>
<li class="nav-item"><a href="/" rel="alternate" hreflang="en" class="nav-link">English</a></li>

                
                <li class="nav-item" id="color-changer-menu">
<a href="#" class="nav-link" id="color-changer-btn">
                <div class="color-changer"></div>
                <span id="color-changer-text"><!--#if expr="$HTTP_COOKIE=/colorScheme\=light/" -->Tryb Ciemny<!--#else -->Tryb Jasny<!--#endif--></span>
                </a>
                </li>
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        <div id="cookiebox"></div>
<article class="post-text h-entry hentry postpage postbox" itemscope="itemscope" itemtype="http://schema.org/Article"><header class="page-header"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/" class="u-url">Reinstalling macOS: What To Try When All Else Fails</a>
    </h1>

    <div class="metadata">
<a href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/" rel="bookmark" class="u-published"><time class="published dt-published" datetime="2020-06-03T23:00:00+02:00" itemprop="datePublished" title="03 czerwca 2020 o 23:00">03 czerwca 2020 o 23:00</time><time class="updated dt-updated" datetime="2022-09-26T19:45:00+02:00" title="aktualizacja 26 września 2022 o 19:45"> (aktualizacja 26 września 2022 o 19:45)</time></a>
        <ul itemprop="keywords" class="tags post-bubbles list-inline">
<li class="category-bubble"><a href="/pl/blog/tags/cat_apple/" style="background-color: #00b55f !important">Apple</a></li>
           <li><a class="tag p-category" href="/pl/blog/tags/apple/" rel="tag">Apple</a></li>
           <li><a class="tag p-category" href="/pl/blog/tags/install/" rel="tag">install</a></li>
           <li><a class="tag p-category" href="/pl/blog/tags/mac/" rel="tag">Mac</a></li>
           <li><a class="tag p-category" href="/pl/blog/tags/macos/" rel="tag">macOS</a></li>
        </ul>
</div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="lead">
<p>Recently, I reinstalled macOS on my device. Throughout the process, many
attempts failed miserably. But I now have some experience and assorted hints on
what to try (as long as you’ve got an Intel Mac).</p>
</div>
</div>
<p><strong>DISCLAIMER:</strong> All information in this post is provided as-is, and some of it may
void your warranty. Neither Chris Warrick nor Apple will be responsible for any
damage to your devices caused as a result of using information in this post.</p>
<p><strong>Note:</strong> This blog post is written for Intel Macs, particularly those that can
boot OS X El Capitan (or macOS Sierra, but that’s untested). If your Mac can’t, you’ll need to look for help
elsewhere. If you’ve got an Apple Silicon Mac, you probably want to perform
<a class="reference external" href="https://support.apple.com/guide/apple-configurator-mac/revive-or-restore-a-mac-with-apple-silicon-apdd5f3c75ad/mac">a DFU restore</a>
(requires another Mac and a USB-C cable.)</p>
<nav class="contents alert alert-primary" id="contents" role="doc-toc"><p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#making-install-media-with-el-capitan-with-access-only-to-recovery" id="toc-entry-1">Making install media with El Capitan (with access only to Recovery)</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#manually-installing-pkg-files" id="toc-entry-2">Manually installing .pkg files</a></p></li>
<li>
<p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#making-install-media-out-of-partial-macos-installers-not-a-valid-os-installer-application" id="toc-entry-3">Making install media out of partial macOS installers (“not a valid OS installer application”)</a></p>
<ul>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#a-from-the-el-capitan-download" id="toc-entry-4">a. From the El Capitan download</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#b-installer-from-recovery-app-store-any-macos-version" id="toc-entry-5">b. Installer from Recovery/App Store (any macOS version)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#el-capitan-installer-cant-be-verified" id="toc-entry-6">El Capitan installer can’t be verified</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#bonus-tidbit-1-how-the-download-works" id="toc-entry-7">Bonus tidbit 1: how the download works</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#bonus-tidbit-2-using-terminal-from-setup-assistant" id="toc-entry-8">Bonus tidbit 2: using Terminal from Setup Assistant</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#bonus-tidbit-3-creating-an-image-of-the-install-media-might-not-work" id="toc-entry-9">Bonus tidbit 3: creating an image of the install media might not work</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#bonus-tidbit-4-dont-bother-restoring-a-time-machine-backup" id="toc-entry-10">Bonus tidbit 4: don’t bother restoring a Time Machine backup</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#an-open-letter-to-progress-bar-designers" id="toc-entry-11">An Open Letter to Progress Bar Designers</a></p></li>
<li><p><a class="reference internal" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#in-the-end" id="toc-entry-12">In the end…</a></p></li>
</ul></nav><section id="making-install-media-with-el-capitan-with-access-only-to-recovery"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-1" role="doc-backlink">Making install media with El Capitan (with access only to Recovery)</a></h2>
<p>The best, safest, least error-prone way to do an install is with a USB stick.
Unfortunately, making a USB stick with the macOS installer on it is a nuisance.
The expected way to produce macOS install media is to download the installer
from App Store/Software Update, and run the <code class="docutils literal">createinstallmedia</code> command-line
program included with that installer app. All is well, as long as macOS works.
If it doesn’t, and Recovery can’t install it for you, that can be difficult to
solve.</p>
<p>Apple does not make macOS images publicly available. That’s probably to make
Hackintoshing this little bit harder, but this also affects legitimate users.
The only thing you can easily download from Apple is El Capitan. Apple offers
<a class="reference external" href="https://support.apple.com/en-us/HT206886">InstallMacOSX.dmg</a> on their
website.</p>
<p>There are also some other downloads available:</p>
<ul class="simple">
<li><p>there’s a Sierra download, with a broken link, although it can be fixed by changing <code class="docutils literal"><span class="pre">updates-http</span></code> to <code class="docutils literal">updates</code>: <a class="reference external" href="https://updates.cdn-apple.com/2019/cert/061-39476-20191023-48f365f4-0015-4c41-9f44-39d3d2aca067/InstallOS.dmg">get Sierra installer</a>.</p></li>
<li><p>if you need something older than El Capitan, downloads are available as far
back as Lion, although these might not have the <code class="docutils literal">createinstallmedia</code> tool
required for this procedure.</p></li>
</ul>
<p>This post assumes you’re working with El Capitan; a quick look though that file
suggests the instructions in this post should work with Sierra as well.</p>
<p>If you take a look at the instructions, you will see that this is
<em>not</em> a bootable OS X image. This image has a <code class="docutils literal">.pkg</code> package. This package is
expected to install <code class="docutils literal">/Applications/Install OS X El Capitan.app</code>. Well, we’re
in recovery, we can’t install stuff. So, let’s do this the manual way.</p>
</section><section id="manually-installing-pkg-files"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-2" role="doc-backlink">Manually installing .pkg files</a></h2>
<p>Turns out the <code class="docutils literal">.pkg</code> format is just an archives all the way down, with all
archives being different formats (at least three).</p>
<aside class="float-md-right mt-md-0 sidebar"><p class="sidebar-title">macOS flat package format</p>
<p>You can find more resources about the flat package format, <a class="reference external" href="http://s.sudre.free.fr/Stuff/Ivanhoe/FLAT.html">one</a> or <a class="reference external" href="https://matthew-brett.github.io/docosx/flat_packages.html#payload_">two</a>, although
this was deduced from the <code class="docutils literal">file</code> command and The Unarchiver.</p>
</aside><p>The first archive is the <code class="docutils literal">.pkg</code> file itself. Those files are in <a class="reference external" href="https://en.wikipedia.org/wiki/Xar_(archiver)">XAR format</a>, which was invented by the
OpenDarwin community. You can either extract it with <code class="docutils literal">pkgutil <span class="pre">--expand</span>
foo.pkg foo_files</code> (the last argument is the destination directory, can be
anything, will be created by <code class="docutils literal">pkgutil</code>) if you have access to that command (it’s
available in Recovery OS), or you can try the <code class="docutils literal">xar</code> utility as <code class="docutils literal">xar <span class="pre">-xf</span>
foo.pkg</code>. The structure produced by both tools is a bit different, but we can
work with both.</p>
<p>The second archive-in-archive is the <code class="docutils literal">Payload</code>. It’s a gzipped cpio archive
that contains the files installed by this package.  If you have BSD tar
(default on macOS, easily installable on Linux), you can just do <code class="docutils literal">tar <span class="pre">-xvf</span> Payload</code>.
Otherwise, you can use <code class="docutils literal">gunzip <span class="pre">-c</span> Payload | cpio <span class="pre">-i</span></code> (or <code class="docutils literal">gzcat</code>). That
will extract all the files the package has.</p>
<p>Another nested archive is the <code class="docutils literal">Scripts</code> archive, although note that
<code class="docutils literal">pkgutil</code> will extract it automatically. If it’s not extracted, it’s actually
<code class="docutils literal">.cpio.gz</code> again, with the same way to extract it.</p>
<p>(PS.  If you have <code class="docutils literal">7z</code> around (on Windows/Linux as well), you can just point
it at all the compressed files mentioned in this paragraph.)</p>
</section><section id="making-install-media-out-of-partial-macos-installers-not-a-valid-os-installer-application"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-3" role="doc-backlink">Making install media out of partial macOS installers (“not a valid OS installer application”)</a></h2>
<section id="a-from-the-el-capitan-download"><h3><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-4" role="doc-backlink">a. From the El Capitan download</a></h3>
<p>Let’s expand the El Capitan package.</p>
<div class="code"><pre class="code console"><a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-1" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-1" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-1"></a><span class="gp">$ </span><span class="o">(</span>mount<span class="w"> </span>the<span class="w"> </span>DMG<span class="w"> </span><span class="k">in</span><span class="w"> </span>Disk<span class="w"> </span>Utility<span class="o">)</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-2" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-2" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-2"></a><span class="gp">$ </span>cp<span class="w"> </span>/Volumes/Install<span class="se">\ </span>OS<span class="se">\ </span>X/InstallMacOSX.pkg<span class="w"> </span>/Volumes/Macintosh<span class="se">\ </span>HD/
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-3" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-3" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-3"></a><span class="go">     (Or copy it to some other volume you can write to; NOT the USB stick)</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-4" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-4" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-4"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>/Volumes/Macintosh<span class="se">\ </span>HD/
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-5" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-5" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-5"></a><span class="gp">$ </span>pkgutil<span class="w"> </span>--expand<span class="w"> </span>InstallMacOSX.pkg<span class="w"> </span>elcapitan
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-6" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-6" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-6"></a><span class="gp">$ </span>ls<span class="w"> </span>-F<span class="w"> </span>elcapitan
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-7" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-7" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-7"></a><span class="go">Distribution*       InstallMacOSX.pkg/ Resources/</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-8" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-8" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-8"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>elcapitan/InstallMacOSX.pkg/
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-9" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-9" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-9"></a><span class="gp">$ </span>tar<span class="w"> </span>-xvf<span class="w"> </span>Payload
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-10" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-10" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-10"></a><span class="go">x .</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-11" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-11" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-11"></a><span class="go">x ./Install OS X El Capitan.app</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-12" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-12" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-12"></a><span class="go">x ./Install OS X El Capitan.app/Contents</span>
<a id="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-13" name="rest_code_66f7d711e3474dac925fc5b68d0a8b5e-13" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_66f7d711e3474dac925fc5b68d0a8b5e-13"></a><span class="go">…</span>
</pre></div>
<p>We’ve got the installer app, which is what we need to create an install image.
Great, let’s try it!</p>
<div class="code"><pre class="code console"><a id="rest_code_30d50d53c9d34eb88e4287360c47c3bc-1" name="rest_code_30d50d53c9d34eb88e4287360c47c3bc-1" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_30d50d53c9d34eb88e4287360c47c3bc-1"></a><span class="gp"># </span><span class="s2">"Install OS X El Capitan.app/Contents/Resources/createinstallmedia"</span><span class="w"> </span>--volume<span class="w"> </span>/Volumes/MyBlankUSBDrive<span class="w"> </span>--applicationpath<span class="w"> </span><span class="s2">"Install OS X El Capitan.app"</span>
<a id="rest_code_30d50d53c9d34eb88e4287360c47c3bc-2" name="rest_code_30d50d53c9d34eb88e4287360c47c3bc-2" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_30d50d53c9d34eb88e4287360c47c3bc-2"></a><span class="go">Install OS X El Capitan.app does not appear to be a valid OS installer application.</span>
</pre></div>
<p>Oh, we’ve got a problem. Turns out there’s one more thing we need to take care
of, and it’s the scripts. MacOS packages have scripts, typically shell scripts,
that are run at various stages in the install process. We can look at the
<code class="docutils literal">PackageInfo</code> file, or just look in the <code class="docutils literal">Scripts</code> folder, to see that
there’s an <code class="docutils literal">link_package</code> script we need to run. This script creates a
<code class="docutils literal">Contents/SharedSupport</code> directory inside the installer app, and
copies/hardlinks the <code class="docutils literal">InstallESD.dmg</code> file (which is the install formerly-DVD
image) to that directory. Let’s try doing this on our own:</p>
<div class="code"><pre class="code console"><a id="rest_code_a0c3615481d5481588ce8b1321371ba5-1" name="rest_code_a0c3615481d5481588ce8b1321371ba5-1" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span><span class="s2">"Install OS X El Capitan.app/Contents/SharedSupport"</span>
<a id="rest_code_a0c3615481d5481588ce8b1321371ba5-2" name="rest_code_a0c3615481d5481588ce8b1321371ba5-2" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-2"></a><span class="gp">$ </span>mv<span class="w"> </span>InstallESD.dmg<span class="w"> </span><span class="s2">"Install OS X El Capitan.app/Contents/SharedSupport"</span>
<a id="rest_code_a0c3615481d5481588ce8b1321371ba5-3" name="rest_code_a0c3615481d5481588ce8b1321371ba5-3" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-3"></a><span class="gp"># </span><span class="s2">"Install OS X El Capitan.app/Contents/Resources/createinstallmedia"</span><span class="w"> </span>--volume<span class="w"> </span>/Volumes/MyBlankUSBDrive<span class="w"> </span>--applicationpath<span class="w"> </span><span class="s2">"Install OS X El Capitan.app"</span>
<a id="rest_code_a0c3615481d5481588ce8b1321371ba5-4" name="rest_code_a0c3615481d5481588ce8b1321371ba5-4" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-4"></a><span class="go">Ready to start.</span>
<a id="rest_code_a0c3615481d5481588ce8b1321371ba5-5" name="rest_code_a0c3615481d5481588ce8b1321371ba5-5" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-5"></a><span class="go">To continue we need to erase the disk at /Volumes/MyBlankUSBDrive.</span>
<a id="rest_code_a0c3615481d5481588ce8b1321371ba5-6" name="rest_code_a0c3615481d5481588ce8b1321371ba5-6" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_a0c3615481d5481588ce8b1321371ba5-6"></a><span class="go">If you wish to continue type (Y) then press return:</span>
</pre></div>
<p>And it works! <code class="docutils literal">createinstallmedia</code> will now produce valid install media.</p>
</section><section id="b-installer-from-recovery-app-store-any-macos-version"><h3><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-5" role="doc-backlink">b. Installer from Recovery/App Store (any macOS version)</a></h3>
<p>If you are in Recovery, you can find an Install app on the filesystem. If you
try to run it, you will get the same error as in the previous paragraph:</p>
<div class="code"><pre class="code text"><a id="rest_code_1511ea1d981341aeaf07b2c8cf1b1c36-1" name="rest_code_1511ea1d981341aeaf07b2c8cf1b1c36-1" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_1511ea1d981341aeaf07b2c8cf1b1c36-1"></a>Install macOS Catalina.app does not appear to be a valid OS installer application.
</pre></div>
<p>This also happens with some older macOS versions, where you get a small
<code class="docutils literal">.app</code> from the App Store, and that app does the actual download.</p>
<p>Whatever the issue was, we need to download the install files with the
installer. Open the installer and let it run until the download finishes. If
the app asks you to reboot, quit it at this point. If it never asks, you can
still find a way to get files out (after a failed install, they should not be
removed).</p>
<p>The install files can be found in <code class="docutils literal">/macOS Install Data</code> on the destination
volume. For older versions, you will just have <code class="docutils literal">InstallESD.dmg</code>, newer
versions add more and more files, some of which are hardware-specific (and
Catalina has <code class="docutils literal">InstallESDDmg.pkg</code>, because Apple loves nesting archives for no
reason!). However many files you find, you can just:</p>
<ol class="arabic simple">
<li><p>Copy <code class="docutils literal">Install macOS Catalina.app</code> to a read-write volume.</p></li>
<li><p>Copy the contents of <code class="docutils literal">/Volumes/TARGET/macOS Install Data</code> to <code class="docutils literal">Install
macOS Catalina.app/Content/SharedSupport</code>. Make sure you account for hidden
files, if any (copy the entire directory). If you did this correctly,
<code class="docutils literal">InstallESDDmg.pkg</code> (or <code class="docutils literal">InstallESD.dmg</code> on older verisons) is in the <code class="docutils literal">SharedSupport</code>
directory (not in a subdirectory).</p></li>
<li><p>Run <code class="docutils literal">createinstallmedia</code>. It should now consider the installer valid. The
available options differ slightly depending on the OS version.</p></li>
</ol></section></section><section id="el-capitan-installer-cant-be-verified"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-6" role="doc-backlink">El Capitan installer can’t be verified</a></h2>
<p>If you get this error, it might be because Apple’s signing keys expired, or
because of other date/time weirdness. Regardless, you can force an install if
you are sure the installer is not damaged with this command <a class="reference external" href="https://apple.stackexchange.com/questions/216730/this-copy-of-the-install-os-x-el-capitan-application-cant-be-verified-it-may-h">(source)</a>:</p>
<div class="code"><pre class="code console"><a id="rest_code_3659cd4684414a80b64b7b1b528c4ba9-1" name="rest_code_3659cd4684414a80b64b7b1b528c4ba9-1" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#rest_code_3659cd4684414a80b64b7b1b528c4ba9-1"></a><span class="gp"># </span>installer<span class="w"> </span>-pkg<span class="w">  </span>/Volumes/Mac<span class="se">\ </span>OS<span class="se">\ </span>X<span class="se">\ </span>Install<span class="se">\ </span>DVD/Packages/OSInstall.mpkg<span class="w"> </span>-target<span class="w"> </span>/Volumes/<span class="s2">"XXX"</span>
</pre></div>
</section><section id="bonus-tidbit-1-how-the-download-works"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-7" role="doc-backlink">Bonus tidbit 1: how the download works</a></h2>
<p>While messing with all the installer stuff, I found out a few
interesting/worrying things about the download process.</p>
<p>The first one is that the macOS installer uses plain HTTP without encryption to
download files. That opens you to all the standard issues — an attacker can
replace files you download, and the protocol doesn’t do anything to detect
errors (the installer will verify files, but where do the checksums come
from?).</p>
<p>The second one is how the download happens. You might have noticed it to be a
bit slower than usual traffic. The download happens in 10 MB chunks, using the
<code class="docutils literal">Range</code> HTTP header. The installer asks for 10 MB, gets it, saves, asks for
another chunk. Repeat that over 800 times, and the overhead of the entire HTTP
dance becomes noticeable. (I haven’t checked, but I hope the installer at least
uses Keep-Alive. I wouldn’t be particularly surprised if it didn’t, though.)</p>
<p>But this raises another question. The servers clearly support partial downloads.
And yet, if your network disconnects during the download, your download
progress for that file is reset, and in Catalina, you can go from 8 GB back to
500 MB if you’re particularly unlucky. The question is, why? This
infrastructure should make it trivial to continue the download, perhaps
discarding the most recent chunk if you’re concerned about that download of it
being unsuccessful.</p>
</section><section id="bonus-tidbit-2-using-terminal-from-setup-assistant"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-8" role="doc-backlink">Bonus tidbit 2: using Terminal from Setup Assistant</a></h2>
<p>The first time you boot a Mac after a clean install, it starts the Setup
Assistant. This app asks for basic OS settings (locale, date/time, user
accounts), and also lets you restore user data from backups.</p>
<p>Sometimes, you might want to access the Terminal or Console from that screen.
You can do that with Ctrl + Opt + Cmd + T and Ctrl + Opt + Cmd + C respectively <a class="reference external" href="https://chris-collins.io/2018/03/15/Using-Terminal-At-macOS-Setup-Assistant/">(source)</a>.</p>
<p>How could that come in handy? For example, if you want to check if the backup
drive still worked and if the process isn’t stuck (I wrote a test file and also
checked <code class="docutils literal">top</code>).</p>
</section><section id="bonus-tidbit-3-creating-an-image-of-the-install-media-might-not-work"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-9" role="doc-backlink">Bonus tidbit 3: creating an image of the install media might not work</a></h2>
<p>A few months later, in December, I upgraded to Big Sur and then installed Windows 10
alongside it in Boot Camp. I then did some more hacks, which led to
two unbootable OSes.</p>
<p>As part of the upgrade, I had prepared install media and used it to install (so
it wouldn’t fail, as it did last time), and made a <code class="docutils literal">.dmg</code> of it with Disk
Utility. (Also, Apple won’t tell you this, but you need to give Disk Utility
<em>Full Disk Access</em> for disk imaging to work. Otherwise, you get a cryptic
error.) I erased the USB drive after installing, but hey, I could get it back.
I booted into Internet Recovery and restored my image. Big Sur failed to boot
and showed a <a class="reference external" href="https://support.apple.com/en-us/HT210901">🚫 sign</a>. I tried
restoring my Catalina image from the previous reinstall, and that didn’t work
due to a size mismatch. I used a different USB drive than these months ago (I
didn’t have that one with me at the moment), and apparently the one I used had
a different size (both are marketed as 16 GB). The images could be mounted
fine, and <code class="docutils literal">createinstallmedia</code> should have worked, likely producing a
bootable drive.</p>
</section><section id="bonus-tidbit-4-dont-bother-restoring-a-time-machine-backup"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-10" role="doc-backlink">Bonus tidbit 4: don’t bother restoring a Time Machine backup</a></h2>
<p>Time Machine is Apple’s magical backup solution. Time Machine saves snapshots
of your entire disk. It’s supposed to help restore files that were deleted or
changed in an unwanted way, or help you restore a full macOS install.</p>
<p>Time Machine is great at file recovery, but none of my 3 system restore
attempts were successful. Attempt #1 was a full Time Machine System Restore,
from Recovery, back in June. It failed partway through, it couldn’t read
everything from the disk. There might have been underlying hardware issues with
that failure, so I had another attempt.</p>
<p>Attempt #2 was a Migration Assistant restore, as part of the initial setup.
This one succeeded, and things worked… except for one fairly important app.
This app requires online activation with the vendor, and it wouldn’t reactivate
after the install. Whatever the third-party vendor is doing didn’t like the
reinstall. I tried to nuke all the things in ~/Library related to their
software, and ran their nuke-everything uninstaller, but that didn’t work.
I reinstalled from scratch and copied over my files, settings and apps from the
Time Machine drive.</p>
<p>Attempt #3 involved the System Restore again, this time for the December
reinstall. The hardware issues were all fixed in the meantime, so I went for a
Time Machine System Restore.</p>
<p><strong>Issue #1:</strong> Internet Recovery booted into Catalina. There was an issue on Apple’s
side, <a class="reference external" href="https://mjtsai.com/blog/2020/12/30/no-more-big-sur-internet-recovery/">Big Sur was unavailable in Internet Recovery in December</a>. TM
Recovery will not restore a backup created with a newer version of macOS than
you’re booted into, so I was forced to restore a slightly older Catalina
backup. (I spent most of my time in Windows during that weekend, so other than
the need to upgrade macOS to Big Sur again, I didn’t really lose any data due
to this.)</p>
<p><strong>Issue #2:</strong> It wasted time computing an inaccurate size estimate. Before
restoring a backup, macOS first checks if it will fit on your drive. When it
does that, an indeterminate progress bar is shown. macOS won’t tell you the
result of that computation, but you can read the final value from the full
Installer Log (Cmd + L). On my Mac, the value was 96.2 GB. I was at the Mac
when it was getting close to that value. 94, 95, 96, 96.1, 96.2, 96.3… hold on
a second, 96.3 GB? Hopefully that’s just a bunch of extra things that are
installed from the system image directly, or something like that, right? Of
course, since the progress bar is based on the pre-computed size, it became
indeterminate and I couldn’t tell when it would end. 98, 100, 110, 120, 121.2
GB is where it ultimately ended. So, not only did it waste 20+ minutes
computing a size, it was off by 25 GB.</p>
<p><strong>Issue #3:</strong> The restore didn’t work. The System Restore finished and claimed to
have succeeded, but macOS wouldn’t boot. It showed an <em>Unrecoverable error</em>,
<em>SecurityAgent was unable to create requested mechanism</em>. Most people who had a
similar error had it caused by a botched TeamViewer uninstall; I didn’t have
that installed, and it was referring to a different component. So, wipe and
fresh reinstall it is.</p>
<p>I copied my stuff from the TM drive, and it was acting weird. Some apps failed
to load their settings copied into Library, others started with a “Move to
/Applications?” prompt (even though they were in that directory). For some
reason, those files had some hidden attribute set on it. I worked around it by
putting files in a <code class="docutils literal">.zip</code> archive with Keka, and then unzipping them;
<code class="docutils literal">xattr</code> might also help. (The attribute was likely <code class="docutils literal">com.apple.quarantine</code>.)</p>
<p>After I got the Mac to work, I reinstalled Windows and set up rEFInd, and it
now works fine. (I only use rEFInd because I want virtualization in Windows,
and that doesn’t work unless you’re warm-rebooting from macOS. I don’t need
anything more advanced than the Option key boot menu, but Apple made me use a
third-party bootloader.)</p>
<p><em>We now go back to the original post from June.</em></p>
</section><section id="an-open-letter-to-progress-bar-designers"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-11" role="doc-backlink">An Open Letter to Progress Bar Designers</a></h2>
<p>Dear Progress Bar Designers: can you please make your progress bars
functional? The macOS progress bar might look sleek at just 7 px (non-Retina)/6
pt = 12 px (Retina) high, but at the same time, you’re looking at individual
pixels if you need to know if it works or if it’s stuck. I have had to point my
mouse cursor at the end of the filled-in part just to know if it’s working or
not. Or sometimes, put a piece of paper in front of my screen, because there is
no mouse cursor when macOS installs on the black screen. How to make
that progress bar easier to use and more informative? Just add numbers on top of
it. For long-running processes, I wouldn’t mind progress bars that said
“12.34%”. That specific Setup/Migration Assistant window should be changed (it
only has a remaining time estimate and transfer speed, it should also show
moved data/total size), but wouldn’t more things benefit from a clear
indication of the progress? Yes, perhaps it looks less sleek, perhaps it
requires more space for the bar.</p>
<p>Just compare: which is easier to parse? Which is more informative?</p>
<div class="mb-3">
<div class="progress" style="height: 6.5px; border-radius: 6.5px;">
  <div class="progress-bar" role="progressbar" style="width: 42.42%;" aria-valuenow="42.42" aria-valuemin="0" aria-valuemax="100"></div>
</div>
</div>
<div class="mb-3">
<div class="progress" style="height: 20px; border-radius: 20px;">
  <div class="progress-bar" role="progressbar" style="width: 42.42%;" aria-valuenow="42.42" aria-valuemin="0" aria-valuemax="100">42%</div>
</div>
</div>
<div class="mb-3">
<div class="progress" style="height: 20px; border-radius: 20px;">
  <div class="progress-bar" role="progressbar" style="width: 42.42%;" aria-valuenow="42.42" aria-valuemin="0" aria-valuemax="100">42.4%</div>
</div>
</div>
<div class="mb-3">
<div class="progress" style="height: 20px; border-radius: 20px;">
  <div class="progress-bar" role="progressbar" style="width: 64.64%;" aria-valuenow="64.64" aria-valuemin="0" aria-valuemax="100"></div>
  <div style="position: absolute; text-align: center; left: 0; right: 0; margin-top: 10px;">64.64% (6.7 GB/10 GB copied)</div>
</div>
</div>
<p>I’d honestly be happy enough with option 2, at least it can be read easily and
you can remember the number instead of a vague position.</p>
</section><section id="in-the-end"><h2><a class="toc-backref" href="/pl/blog/2020/06/03/reinstalling-macos-what-to-try-when-all-else-fails/#toc-entry-12" role="doc-backlink">In the end…</a></h2>
<p>After all this, I managed to get macOS Catalina installed. After various
failures in built-in El Capitan recovery and Catalina Internet Recovery, I first
installed El Capitan with this hack, then jumped to Mojave because I thought
the new Software Update would help (it didn’t, same installer, same
failed-to-extract-package issue), then made a Catalina USB stick, and it
finally clean-installed, but I was worried about the backup disk’s operation,
and I used a proxy on my local network to try and speed up Catalina downloads
without much improvement… but hey, at least it works. Apple should really make
it easier to install their OS and to make boot media even when stuff doesn’t
work, even from Windows. The Hackintosh folks can just find someone with a
working Mac and ask them to download from App Store and make install media, or
find less legitimate sources, they probably don’t care as much. But if my own
system crashes, I’d probably want to get working install media immediately,
myself, and from Apple. Without all this mess.</p>
</section></article>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="/pl/blog/2020/02/09/when-html-is-not-enough-a-tale-of-the-datalist-element/" rel="prev" title="When HTML is not enough: a tale of the &lt;datalist&gt; element">Poprzedni post</a>
            </li>
            <li class="next">
                <a href="/pl/blog/2020/06/22/what-an-arm-mac-means-for-developers-and-windows-users/" rel="next" title="What an ARM Mac means for developers and Windows users">Następny post</a>
            </li>
        </ul></nav></aside><section class="comments"><div data-title="Reinstalling macOS: What To Try When All Else Fails" id="isso-thread"></div>
        <script src="https://isso.chriswarrick.com/js/embed.min.js" data-isso="https://isso.chriswarrick.com/" data-isso-lang="pl" data-isso-require-author="true" data-isso-require-email="true" data-isso-gravatar="true" data-isso-avatar="false" data-isso-css="false" data-isso-vote="false" data-isso-reply-notifications="true"></script></section><!--End of body content--><nav id="footer-links"><div class="row">
            <div class="col-sm-4">
                <h6>Blog</h6>
                <ul>
<li class="nav-item">
<a href="/pl/blog/" class="nav-link">Archiwum</a>
                        </li>
<li class="nav-item">
<a href="/pl/blog/tags/" class="nav-link">Tagi</a>
                        </li>
<li class="nav-item">
<a href="/pl/rss.xml" class="nav-link">Kanał RSS</a>
                        </li>
<li class="nav-item">
<a href="/pl/search/" class="nav-link">Wyszukiwarka</a>
                </li>
</ul>
</div>
            <div class="col-sm-4">
                <h6>Projekty i Twórczość</h6>
                <ul>
<li class="nav-item">
<a href="/projects/" class="nav-link">Projekty (en)</a>
                        </li>
<li class="nav-item">
<a href="/guides/" class="nav-link">Przewodniki (en)</a>
                        </li>
<li class="nav-item">
<a href="/pl/kwbot/" class="nav-link">KwBot</a>
                        </li>
<li class="nav-item">
<a href="/pl/blog/tags/cat_python" class="nav-link">Posty o Pythonie</a>
                </li>
</ul>
</div>
            <div class="col-sm-4">
                <h6>Ja</h6>
                <ul>
<li class="nav-item">
<a href="/pl/contact/" class="nav-link">Kontakt</a>
                        </li>
<li class="nav-item">
<a href="/pl/brand/" class="nav-link">Brand</a>
                        </li>
<li class="nav-item">
<a href="https://twitter.com/Kwpolska" class="nav-link">Twitter</a>
                        </li>
<li class="nav-item">
<a href="https://github.com/Kwpolska" class="nav-link">GitHub</a>
                </li>
</ul>
</div>
        </div></nav><footer id="footer"><p>ta strona używa ciasteczek.<br>
korzystając z tej strony, akceptujesz naszą <a href="/pl/privacy/">politykę prywatności i ciasteczek</a>.
</p>
<p>
powered by <strong><a href="https://getnikola.com/">Nikola</a></strong>, <a href="http://nginx.org/">nginx</a> and <a href="https://hetzner.cloud/?ref=Qy1lehF8PwzP">Hetzner Cloud</a><br>
copyright © 2009–2025 <a href="/pl/contact/">Chris Warrick</a><br><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC
BY-NC-SA</a>, unless stated otherwise</p>
            
        </footer>
</div>


    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.0/baguetteBox.min.js" integrity="sha256-yQGjQhFs3LtyiN5hhr3k9s9TWZOh/RzCkD3gwwCKlkg=" crossorigin="anonymous"></script><script src="/assets/js/all.js?v=20230115"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><!-- Matomo --><script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.chriswarrick.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script><!-- End Matomo Code -->
</body>
</html>