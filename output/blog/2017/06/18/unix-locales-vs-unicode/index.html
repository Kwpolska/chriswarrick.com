<!DOCTYPE html>
<html class="limited-width larger-font" prefix="
og: http://ogp.me/ns#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to configure locales for Unicode support.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Unix locales vs Unicode (‘ascii’ codec can’t encode character…) | Chris Warrick</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css" integrity="sha256-FqCzNnnyXl5HxHMdb+RQ/RV/X7fqfPcQYy+G2gFL3Xk=" crossorigin="anonymous">
<!--#if expr="$HTTP_COOKIE=/colorScheme\=light/" --><link href="/assets/css/all.css" rel="stylesheet" type="text/css" id="kw-all-css">
<script type="text/javascript">var colorScheme='light';var colorSchemesEnabled=true;</script><!--#else--><link href="/assets/css/all-dark.css" rel="stylesheet" type="text/css" id="kw-all-css">
<script type="text/javascript">var colorScheme='dark';var colorSchemesEnabled=true;</script><!--#endif--><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i%7CSource+Serif+Pro:600&amp;display=swap&amp;subset=latin-ext" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<meta name="theme-color" content="#00aadd">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="/rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="/pl/rss.xml">
<link rel="canonical" href="https://chriswarrick.com/blog/2017/06/18/unix-locales-vs-unicode/">
<link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="16x16 32x32 48x48 64x64 128x128 256x256">
<link rel="icon" type="image/png" href="/assets/img/logo512.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="description" itemprop="description" content="How to configure locales for Unicode support.">
<meta name="author" content="Chris Warrick">
<link rel="prev" href="/blog/2017/06/08/apples-new-pricing-strategy-dont-buy-the-12-macbook/" title="Apple’s new pricing strategy: don't buy the 12″ MacBook" type="text/html">
<link rel="next" href="/blog/2017/06/24/apple-broke-the-display-menu-so-i-wrote-my-own/" title="Apple broke the display menu, so I wrote my own" type="text/html">
<meta property="og:site_name" content="Chris Warrick">
<meta property="og:title" content="Unix locales vs Unicode (‘ascii’ codec can’t encode character…)">
<meta property="og:url" content="https://chriswarrick.com/blog/2017/06/18/unix-locales-vs-unicode/">
<meta property="og:description" content="How to configure locales for Unicode support.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-06-18T20:40:00+02:00">
<meta property="article:tag" content="guide">
<meta property="article:tag" content="locale">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Unicode">
<meta property="article:tag" content="Unix">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@Kwpolska">
<link rel="alternate" hreflang="pl" href="/pl/blog/2017/06/18/unix-locales-vs-unicode/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md navbar-kw bg-dark static-top mb-4"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="/">
            <img src="/assets/img/logo.png" srcset="/assets/img/logo2x.png 2x" alt="Chris Warrick" id="logo"><span id="blog-title">Chris Warrick</span>
        </a>
        <div>
        <button class="navbar-toggler mr-2" id="color-changer-mobile" type="button" aria-label="Change color scheme">
            <span class="color-changer"></span>
        </button>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        </div>
        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="/contact/" class="nav-link">Contact</a>
                </li>
<li class="nav-item">
<a href="/projects/" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="/guides/" class="nav-link">Guides</a>
                </li>
<li class="nav-item">
<a href="/blog/" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="/search/" class="nav-link">Search</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li>            </li>
<li class="nav-item"><a href="/pl/" rel="alternate" hreflang="pl" class="nav-link">Polski</a></li>

                
                <li class="nav-item" id="color-changer-menu">
<a href="#" class="nav-link" id="color-changer-btn">
                <div class="color-changer"></div>
                <span id="color-changer-text"><!--#if expr="$HTTP_COOKIE=/colorScheme\=light/" -->Dark Mode<!--#else -->Light Mode<!--#endif--></span>
                </a>
                </li>
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        <div id="cookiebox"></div>
<article class="post-text h-entry hentry postpage postbox" itemscope="itemscope" itemtype="http://schema.org/Article"><header class="page-header"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="/blog/2017/06/18/unix-locales-vs-unicode/" class="u-url">Unix locales vs Unicode (‘ascii’ codec can’t encode character…)</a>
    </h1>

    <div class="metadata">
<a href="/blog/2017/06/18/unix-locales-vs-unicode/" rel="bookmark" class="u-published"><time class="published dt-published" datetime="2017-06-18T20:40:00+02:00" itemprop="datePublished" title="18 June 2017 at 20:40">18 June 2017 at 20:40</time></a>
        <ul itemprop="keywords" class="tags post-bubbles list-inline">
<li class="category-bubble"><a href="/blog/tags/cat_programming/" style="background-color: #ff5dd6">Programming</a></li>
           <li><a class="tag p-category" href="/blog/tags/guide/" rel="tag">guide</a></li>
           <li><a class="tag p-category" href="/blog/tags/locale/" rel="tag">locale</a></li>
           <li><a class="tag p-category" href="/blog/tags/python/" rel="tag">Python</a></li>
           <li><a class="tag p-category" href="/blog/tags/unicode/" rel="tag">Unicode</a></li>
           <li><a class="tag p-category" href="/blog/tags/unix/" rel="tag">Unix</a></li>
        </ul>
<span class="shortlink-bubble"><a href="https://go.chriswarrick.com/locale" title="Short link to this article (go.chriswarrick.com/locale)"><i class="fa fa-link"></i> locale</a></span>        
<p class="guide-header">A <a href="/guides/">guide</a> about <span class="guide-topic">Locale support/Unicode</span> for <span class="guide-platform">Unix (Linux, macOS, etc.)</span></p>    </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="lead"><div>
<p>You might get unusual errors about Unicode and inability to convert
to ASCII. Programs might just crash at random. Those are often simple to fix —
all you need is correct locale configuration.</p>
</div></div>
<p class="lead">Has this ever happened to you?</p>
<pre class="code pytb"><a name="rest_code_78e9d999c18b4d0dbe3896b89e2c4d62-1"></a><span class="gt">Traceback (most recent call last):</span>
<a name="rest_code_78e9d999c18b4d0dbe3896b89e2c4d62-2"></a>  File <span class="nb">"aogonek.py"</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<a name="rest_code_78e9d999c18b4d0dbe3896b89e2c4d62-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">u</span><span class="s1">'</span><span class="se">\u0105</span><span class="s1">'</span><span class="p">)</span>
<a name="rest_code_78e9d999c18b4d0dbe3896b89e2c4d62-4"></a><span class="gr">UnicodeEncodeError</span>: <span class="n">'ascii' codec can't encode character '\u0105' in position 0: ordinal not in range(128)</span>
</pre>
<pre class="code text"><a name="rest_code_4be0f6096a3046f09969bb3c142819fa-1"></a>Nikola: Could not guess locale for language en, using locale C
</pre>
<pre class="code text"><a name="rest_code_be32d51d11a34190b08e79fe626568f4-1"></a>Input: ą
<a name="rest_code_be32d51d11a34190b08e79fe626568f4-2"></a>Desired ascii(): '\u0105'
<a name="rest_code_be32d51d11a34190b08e79fe626568f4-3"></a>Real ascii(): '\udcc4\udc85'
</pre>
<pre class="code text"><a name="rest_code_f6b79b0d7161489d919f973d73b0595d-1"></a>perl: warning: Setting locale failed.
<a name="rest_code_f6b79b0d7161489d919f973d73b0595d-2"></a>perl: warning: Please check that your locale settings:
<a name="rest_code_f6b79b0d7161489d919f973d73b0595d-3"></a>    [...]
<a name="rest_code_f6b79b0d7161489d919f973d73b0595d-4"></a>    are supported and installed on your system.
<a name="rest_code_f6b79b0d7161489d919f973d73b0595d-5"></a>perl: warning: Falling back to the standard locale ("C").
</pre>
<p class="lead">All those errors have the same root cause: incorrect locale configuration.
To fix them all, you need to generate the missing locales and set them.</p>
<div class="section" id="check-currently-used-locale">
<h2>Check currently used locale<a href="#check-currently-used-locale" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal">locale</code> command (without arguments) should tell you which locales you’re
currently using.  (The list might be shorter on your end)</p>
<pre class="code sh"><a name="rest_code_072d05a61ea245529d04e27cab74478b-1"></a>$ locale
<a name="rest_code_072d05a61ea245529d04e27cab74478b-2"></a><span class="nv">LANG</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-3"></a><span class="nv">LC_CTYPE</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-4"></a><span class="nv">LC_NUMERIC</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-5"></a><span class="nv">LC_TIME</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-6"></a><span class="nv">LC_COLLATE</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-7"></a><span class="nv">LC_MONETARY</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-8"></a><span class="nv">LC_MESSAGES</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-9"></a><span class="nv">LC_PAPER</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-10"></a><span class="nv">LC_NAME</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-11"></a><span class="nv">LC_ADDRESS</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-12"></a><span class="nv">LC_TELEPHONE</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-13"></a><span class="nv">LC_MEASUREMENT</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-14"></a><span class="nv">LC_IDENTIFICATION</span><span class="o">=</span><span class="s2">"en_US.UTF-8"</span>
<a name="rest_code_072d05a61ea245529d04e27cab74478b-15"></a><span class="nv">LC_ALL</span><span class="o">=</span>
</pre>
<p>If any of those is set to <code class="docutils literal">C</code> or <code class="docutils literal">POSIX</code>, has a different encoding than
<code class="docutils literal"><span class="pre">UTF-8</span></code> (sometimes spelled <code class="docutils literal">utf8</code>) is empty (with the exception of
<code class="docutils literal">LC_ALL</code>), or if you see any errors, you need to reconfigure your locale.</p>
</div>
<div class="section" id="check-locale-availability-and-install-missing-locales">
<h2>Check locale availability and install missing locales<a href="#check-locale-availability-and-install-missing-locales" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>The first thing you need to do is check locale availability. To do this, run
<code class="docutils literal">locale <span class="pre">-a</span></code>. This will produce a list of all installed locales.  You can use
<code class="docutils literal">grep</code> to get a more reasonable list.</p>
<pre class="code text"><a name="rest_code_6e7ae05e863d4e8e9eed11430837f090-1"></a>$ locale -a | grep -i utf
<a name="rest_code_6e7ae05e863d4e8e9eed11430837f090-2"></a>&lt;lists all UTF-8 locales&gt;
<a name="rest_code_6e7ae05e863d4e8e9eed11430837f090-3"></a>$ locale -a | grep -i utf | grep -i en_US
<a name="rest_code_6e7ae05e863d4e8e9eed11430837f090-4"></a>en_US.UTF-8
</pre>
<p>The best locale to use is the one for your language, with the UTF-8 encoding.
The locale will be used by some console apps for output. I’m going to use
<code class="docutils literal"><span class="pre">en_US.UTF-8</span></code> in this guide.</p>
<p>If you can’t see any UTF-8 locales, or no appropriate locale setting for your
language of choice, you might need to generate those. The required actions
depend on your distro/OS.</p>
<ul class="simple">
<li><p>Debian, Ubuntu, and derivatives: install <code class="docutils literal"><span class="pre">language-pack-en-base</span></code>, run <code class="docutils literal">sudo <span class="pre">dpkg-reconfigure</span> locales</code></p></li>
<li><p>RHEL, CentOS, Fedora: install <code class="docutils literal"><span class="pre">glibc-langpack-en</span></code></p></li>
<li><p>Arch Linux: uncomment relevant entries in <code class="docutils literal">/etc/locale.gen</code> and run <code class="docutils literal">sudo <span class="pre">locale-gen</span></code> <a class="reference external" href="https://wiki.archlinux.org/index.php/Locale">(wiki)</a></p></li>
<li><p>For other OSes, refer to the documentation.</p></li>
</ul>
<p>You need a UTF-8 locale to ensure compatibility with software. Avoid the <code class="docutils literal">C</code>
and <code class="docutils literal">POSIX</code> locales (it’s ASCII) and locales with other encodings (those
aren’t used by ~anyone these days)</p>
</div>
<div class="section" id="configure-system-wide">
<h2>Configure system-wide<a href="#configure-system-wide" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>On some systems, you may be able to configure locale system-wide.  Check your
system documentation for details. If your system has systemd, run</p>
<pre class="code text"><a name="rest_code_3c6ba1b5fa9541caa242310b169b0763-1"></a>sudo localectl set-locale LANG=en_US.UTF-8
</pre>
</div>
<div class="section" id="configure-for-a-single-user">
<h2>Configure for a single user<a href="#configure-for-a-single-user" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>If your environment does not allow system-wide locale configuration (macOS,
shared server with generated but unconfigured locales), or if you want to
ensure it’s always configured independently of system settings.</p>
<p>To do this, you need to edit the configuration file for your shell. If you’re
using bash, it’s <code class="docutils literal">.bashrc</code> (or <code class="docutils literal">.bash_profile</code> on macOS). For zsh users,
<code class="docutils literal">.zshrc</code>.  Add this line (or equivalent in your shell):</p>
<pre class="code sh"><a name="rest_code_8eb0009196cd42acaf5ba75482b40a86-1"></a><span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 <span class="nv">LC_ALL</span><span class="o">=</span>en_US.UTF-8
</pre>
<p>That should be enough. Note that those settings don’t apply to programs
not launched through a shell.</p>
<hr class="docutils">
<p><strong>Python/Windows corner:</strong> Python 3.7 will fix this on Unix by assuming UTF-8
if it encounters the C locale.  On Windows, Python 3.6 is using UTF-8
interactively, but not when using shell redirections to files or pipes.</p>
<p><em>This post was brought to you by ą — U+0105 LATIN SMALL LETTER A WITH OGONEK.</em></p>
</div>
</div>
    </article>
</div>
    <aside class="postpromonav"><div class="card guide-footer">
  <div class="card-header bg-primary border-primary"><h3>That’s all!</h3></div>
  <div class="card-body">
    Hopefully, the guide worked for you and you can now use Unicode in many more places. If so, great! Otherwise, make sure you did everything as stated in this guide. If you are still stuck, ask for help in the comments.
  </div>
  <div class="card-footer"><a href="/guides/">Check out my other guides!</a></div>
</div>
    <nav><ul class="pager hidden-print">
<li class="previous">
                <a href="/blog/2017/06/08/apples-new-pricing-strategy-dont-buy-the-12-macbook/" rel="prev" title="Apple’s new pricing strategy: don't buy the 12″ MacBook">Previous post</a>
            </li>
            <li class="next">
                <a href="/blog/2017/06/24/apple-broke-the-display-menu-so-i-wrote-my-own/" rel="next" title="Apple broke the display menu, so I wrote my own">Next post</a>
            </li>
        </ul></nav></aside><section class="comments"><div data-title="Unix locales vs Unicode (‘ascii’ codec can’t encode character…)" id="isso-thread"></div>
        <script src="https://isso.chriswarrick.com/js/embed.min.js" data-isso="https://isso.chriswarrick.com/" data-isso-lang="en" data-isso-require-author="true" data-isso-require-email="true" data-isso-gravatar="true" data-isso-avatar="false" data-isso-css="false" data-isso-vote="false" data-isso-reply-notifications="true"></script></section><!--End of body content--><nav id="footer-links"><div class="row">
            <div class="col-sm-4">
                <h6>Blog</h6>
                <ul>
<li class="nav-item">
<a href="/blog/" class="nav-link">Archive</a>
                        </li>
<li class="nav-item">
<a href="/blog/tags/" class="nav-link">Tags</a>
                        </li>
<li class="nav-item">
<a href="/rss.xml" class="nav-link">RSS Feed</a>
                        </li>
<li class="nav-item">
<a href="/search/" class="nav-link">Search</a>
                </li>
</ul>
</div>
            <div class="col-sm-4">
                <h6>Projects and Work</h6>
                <ul>
<li class="nav-item">
<a href="/projects/" class="nav-link">Projects</a>
                        </li>
<li class="nav-item">
<a href="/guides/" class="nav-link">Guides</a>
                        </li>
<li class="nav-item">
<a href="/kwbot/" class="nav-link">KwBot</a>
                        </li>
<li class="nav-item">
<a href="/blog/tags/cat_python" class="nav-link">Posts about Python</a>
                </li>
</ul>
</div>
            <div class="col-sm-4">
                <h6>Me</h6>
                <ul>
<li class="nav-item">
<a href="/contact/" class="nav-link">Contact</a>
                        </li>
<li class="nav-item">
<a href="/brand/" class="nav-link">Brand</a>
                        </li>
<li class="nav-item">
<a href="https://twitter.com/Kwpolska" class="nav-link">Twitter</a>
                        </li>
<li class="nav-item">
<a href="https://github.com/Kwpolska" class="nav-link">GitHub</a>
                </li>
</ul>
</div>
        </div></nav><footer id="footer"><p>this site uses cookies.<br>by using this site, you agree to our <a href="/privacy/">cookie and privacy policy</a>.</p>
<p>
powered by <strong><a href="https://getnikola.com/">Nikola</a></strong>, <a href="http://nginx.org/">nginx</a> and <a href="https://hetzner.cloud/?ref=Qy1lehF8PwzP">Hetzner Cloud</a><br>
copyright © 2009–2020 <a href="/contact/">Chris Warrick</a><br><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC
BY-NC-SA</a>, unless stated otherwise</p>
            
        </footer>
</div>


    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.0/baguetteBox.min.js" integrity="sha256-yQGjQhFs3LtyiN5hhr3k9s9TWZOh/RzCkD3gwwCKlkg=" crossorigin="anonymous"></script><script src="/assets/js/all.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11937989-1', 'chriswarrick.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
</body>
</html>